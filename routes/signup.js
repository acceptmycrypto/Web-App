var express = require('express');
var app = express();
var router = express.Router();
var mysql = require('mysql');
var bodyParser = require('body-parser');
var methodOverride = require('method-override');
//use sendgrid
var sgMail = require("@sendgrid/mail");
var keys = require("../key");
sgMail.setApiKey(keys.sendgrid);

app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());
app.use(express.static('public'));
app.use(methodOverride('_method'));

var connection = mysql.createConnection({
  host: 'localhost',

  // Your port; if not 3306
  port: 3306,

  // Your username
  user: 'root',

  // Your password
  password: 'password',
  database: 'crypto_db'
});

router.post('/SignUp', function(req, res) {
  // Get sent data.
  var user = req.body;
  // Do a MySQL query.
  connection.query('INSERT INTO users SET ?',
  { 
  username: user.userName,
  email: user.email,
  password: user.password,
  cyrptoProfil: user.cyrptoProfil,
  hasAgreed: user.hasAgreed
  },

  function(err, result) {
    // Neat!
  });
  res.end('Success');
});








// app.post('/SignUp', function(req, res) {
//   // Get sent data.
//   var user = req.body;
//   // Do a MySQL query.
//   var query = connection.query('INSERT INTO ____ SET ?', ____, function(err, result) {
//     // Neat!
//   });
//   res.end('Success');
// });

/*
Sendgrid Example. Wait for singup to be completed before this can be integrated
const msg = {
  to: 'simonnguyen3054@gmail.com',
  from: 'simon@acceptmycrypto.com',
  subject: 'Email Testing: Generated by our server',
  text: 'and easy to do anywhere, even with Node.js',
  html: '<strong>and easy to do anywhere, even with Node.js</strong>',
};
sgMail.send(msg);
*/

module.exports = router;